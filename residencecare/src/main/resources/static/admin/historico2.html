<!DOCTYPE html> 
<html>
    <head>
        <meta charset="utf-8">
          <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
       <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">

        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

        <!-- Popper JS -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>

        <!-- Latest compiled JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
		<!-- High Charts-->
	<script src="https://code.highcharts.com/highcharts.js"></script>
	<script src="https://code.highcharts.com/modules/data.js"></script>
	
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/export-data.js"></script>
 

		 <script src="../js/restrito.js"></script>
	 
		<script>
		 
		$.ajax({
		    type: "GET",
		    url: "/historico/historicoTemperatura",
		    data: "",
		    headers:createAuthorizationTokenHeader(),
		    dataType: "json",
		    success: function(data){		    	     
	 	          	 var dataVector= [];
			          data.forEach(function(item, valor) {
			        	     cc =(item.dataHora+"").split(' ');		        	    
				    	     data=cc[0].split('-');
				    	     hora=cc[1].split(':');
				             t=Date.UTC( data[2],data[1]-1, data[0], hora[0], hora[1], hora[2]); 
	 		        	     dataVector.push([t,item.dado]);	                   
		              }); 
			          var detailChart;

			          // create the detail chart
			          function createDetail(masterChart) {

			              // prepare the detail chart
			              var detailData = [],
			                  detailStart = dataVector[0][1];

			              $.each(masterChart.series[0].data, function () {
			                  if (this.x >= detailStart) {
			                	   
			                      detailData.push(this.y); 
			                  }
			              });

			              // create a detail chart referenced by a global variable
			              detailChart = Highcharts.chart('detail-container', {
			                  chart: {
			                	  type:'line',
			                      marginBottom: 120,
			                      reflow: true,
			                      marginLeft: 50,
			                      marginRight: 20,
			                      style: {
			                          position: 'absolute'
			                      }
			                  },
			                  credits: {
			                      enabled: true			                 
			                   },
			                  title: {
			                      text: 'Histórico de variação de temperatura'
			                  },
			                  subtitle: {
			                      text: 'Selecione uma área arrastando sobre o gráfico pequeno'
			                  },
			                  xAxis: {
					                type: 'datetime',
					                dateTimeLabelFormats: { 		                	 
					                    second: '%H:%M:%S',
					                    minute: '%H:%M',
					                    hour: '%H:%M',
					                    day: '%e. %b',
					                    week: '%e. %b',
					                    month: '%b \'%y',
					                    year: '%Y'
					                } 		                	
					            }, 
					            yAxis: { 
					                title: {
					                    text: 'Temperatura(°C)' 
					                } ,
						            labels: {
						                format: '{value}°C',
						                style: {
						                		color: Highcharts.getOptions().colors[1]
						                }
						            }
					            }    ,
					            tooltip: {
					            	headerFormat: '<b>{series.name}</b><br>',
					                formatter: function () {
					                    return '<b>' + this.series.name + '</b><br/>' +
					                        Highcharts.dateFormat('%d-%m-%Y %H:%M:%S', this.x) + '<br/>' +
					                        Highcharts.numberFormat(this.y, 1)+'Cº';
					                }
					            }  
			                   ,
			                  legend: {
			                      enabled: true
			                  },
			                  plotOptions: {
			                      series: {
			                          marker: {
			                              enabled: false,
			                              states: {
			                                  hover: {
			                                      enabled: true,
			                                      radius: 3
			                                  }
			                              }
			                          }
			                      }
			                  },
			                  series: [{
			                      name: 'Temperatura',
			                      pointStart: detailStart,
			                      pointInterval: 24 * 3600 * 1000,
			                      data: detailData,
			                      zones: [{
					                	   value: -35,
					                	   color: '#0000FF'
					                	},{
					                	   value: 20,
					                	   color: '#0000FF'
					                	}, {
					                	   value: 35,
					                	   color: '#00FF00'
					                	}, {
					                	   color: '#FF0000'
					                	}]
			                  }],

			                  exporting: {
			                      enabled: false
			                  }

			              }); // return chart
			          }

			          // create the master chart
			          function createMaster() {
			              Highcharts.chart('master-container', {
			                  chart: {
			                      reflow: false,
			                      borderWidth: 0,
			                      backgroundColor: null,
			                      marginLeft: 50,
			                      marginRight: 20,
			                      zoomType: 'x',
			                      events: {

			                          // listen to the selection event on the master chart to update the
			                          // extremes of the detail chart
			                          selection: function (event) {
			                              var extremesObject = event.xAxis[0],
			                                  min = extremesObject.min,
			                                  max = extremesObject.max,
			                                  detailData = [],
			                                  xAxis = this.xAxis[0];

			                              // reverse engineer the last part of the data
			                              $.each(this.series[0].data, function () {
			                                  if (this.x > min && this.x < max) {
			                                      detailData.push([this.x, this.y]);
			                                  }
			                              });

			                              // move the plot bands to reflect the new detail span
			                              xAxis.removePlotBand('mask-before');
			                              xAxis.addPlotBand({
			                                  id: 'mask-before',
			                                  from: dataVector[0][1],
			                                  to: min,
			                                  color: 'rgba(0, 0, 0, 0.2)'
			                              });

			                              xAxis.removePlotBand('mask-after');
			                              xAxis.addPlotBand({
			                                  id: 'mask-after',
			                                  from: max,
			                                  to: dataVector[dataVector.length - 1][1],
			                                  color: 'rgba(0, 0, 0, 0.2)'
			                              });


			                              detailChart.series[0].setData(detailData);

			                              return false;
			                          }
			                      }
			                  },
			                  title: {
			                      text: ""
			                  },
			                  xAxis: {
			                      type: 'datetime',
			                      showLastTickLabel: true,
			                      maxZoom: 100 * 24 * 3600000, // fourteen days
			                      plotBands: [{
			                          id: 'mask-before',
			                          from: dataVector[0][1],
			                          to: dataVector[dataVector.length - 1][1],
			                          color: 'rgba(0, 0, 0, 0.2)'
			                      }],
			                      title: {
			                          text: null
			                      },
				                  dateTimeLabelFormats: { 		                	 
					                    second: '%H:%M:%S',
					                    minute: '%H:%M',
					                    hour: '%H:%M',
					                    day: '%e. %b',
					                    week: '%e. %b',
					                    month: '%b \'%y',
					                    year: '%Y'
					                } 		
			                  },
			                  yAxis: {
			                	  title: {
					                    text: 'Temperatura(°C)' 
					                } ,
						            labels: {
						                format: '{value}°C',
						                style: {
						                		color: Highcharts.getOptions().colors[1]
						                }
						            },
			                      gridLineWidth: 0,			                       
			                      min: 0.6,
			                      showFirstLabel: false
			                  }, 
					            tooltip: {
					            	headerFormat: '<b>{series.name}</b><br>',
					                formatter: function () {
					                    return '<b>' + this.series.name + '</b><br/>' +
					                        Highcharts.dateFormat('%d-%m-%Y %H:%M:%S', this.x) + '<br/>' +
					                        Highcharts.numberFormat(this.y, 1)+'Cº';
					                },
				                    shared: true
					            },
			                  
					            legend: {
					                layout: 'vertical',
					                align: 'right',
					                verticalAlign: 'middle'
					            },
			                  credits: {
			                      enabled: false
			                  },
			                  plotOptions: {
			                      series: {
			                          fillColor: {
			                              linearGradient: [0, 0, 0, 70],
			                              stops: [
			                                  [0, Highcharts.getOptions().colors[0]],
			                                  [1, 'rgba(255,255,255,0)']
			                              ]
			                          },
			                          lineWidth: 1,
			                          marker: {
			                              enabled: false
			                          },
			                          shadow: false,
			                          states: {
			                              hover: {
			                                  lineWidth: 1
			                              }
			                          },
			                          enableMouseTracking: false
			                          
			                      }
			                  },

			                  series: [{
			                      type: 'area',
			                      name: 'Temperatura',
			                      pointInterval: 24 * 3600 * 1000,
			                      pointStart: dataVector[0][1],
			                      data: dataVector,
					                zones: [{
					                	   value: -35,
					                	   color: '#0000FF'
					                	},{
					                	   value: 20,
					                	   color: '#0000FF'
					                	}, {
					                	   value: 35,
					                	   color: '#00FF00'
					                	}, {
					                	   color: '#FF0000'
					                	}]
			                  }],

			                  exporting: {
			                      enabled: false
			                  }

			              }, function (masterChart) {
			                  createDetail(masterChart);
			              }); // return chart instance
			          }

			          // make the container smaller and add a second container for the master chart
			          var $container = $('#container-temperatura')
			              .css('position', 'relative');

			          $('<div id="detail-container">')
			              .appendTo($container);

			          $('<div id="master-container">')
			              .css({
			                  position: 'absolute',
			                  top: 300,
			                  height: 100,
			                  width: '100%'
			              })
			                  .appendTo($container);

			          // create master and in its callback, create the detail chart
			          createMaster();
		    }
		});
		
		</script>
        <style>
            /* The switch - the box around the slider */
            .switch {
            position: relative;
            display: inline-block;
            width: 80px;
            height: 34px;
            left: 15px;
            }

            /* Hide default HTML checkbox */
            .switch input {display:none;}

            /* The slider */
            .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: red;
            -webkit-transition: .4s;
            transition: .4s;
            }

            .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            }

            input:checked + .slider {
            background-color: green;
            }

            input:focus + .slider {
            box-shadow: 0 0 1px #2196F3;
            }

            input:checked + .slider:before {
            -webkit-transform: translateX(43px);
            -ms-transform: translateX(43px);
            transform: translateX(43px);
            }

            /* Rounded sliders */
            .slider.round {
            border-radius: 34px;
            }

            .slider.round:before {
            border-radius: 50%;
            }
			.btn-link:link, .btn-link:hover, .btn-link:alink{
				color:white !important;
			}
			@include media-breakpoint-down(xs) {   }
			@include media-breakpoint-down(sm) {   }
			@include media-breakpoint-down(md) {   }
			@include media-breakpoint-down(lg) {   }
			
			
        
        </style>
		
    </head>
    <body class="bg-dark">
           
        <div class="container bg-dark">
                <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
                        <a class="navbar-brand" href="#"><h1>Residence Care</h1></a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                          <span class="navbar-toggler-icon"></span>
                        </button>                      
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                          <ul class="navbar-nav mr-auto">
                            <li class="nav-item">
                              <a class="nav-link" href="equipamento.html">Ligar e Desligar Equipamentos</a>
                            </li>
                            <li class="nav-item">
                              <a class="nav-link" href="dashboard.html">Dashboard</a>
                            </li> 
                            <li class="nav-item active">
                              <a class="nav-link" href="historico.html">Histórico</a>
                            </li>                            							
                          </ul>                          
                        </div>
                </nav>


                <div class="row">
					 <div class="col-lg-12 col-md-12 column ui-sortable bg-light">
						 <div class="box box-element">
							<div id="container-temperatura" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
						 </div>
 
					 </div>
					  
				</div>
        </div>
         
    </body>

</html>
